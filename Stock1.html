<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡πÄ‡∏î‡∏≠‡∏∞ ‡∏ã‡∏±‡∏û‡∏û‡∏≠‡∏£‡πå‡∏ï ‡∏à‡∏≥‡∏Å‡∏±‡∏î (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà) ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å FIFO</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ò‡∏µ‡∏° ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô-‡∏°‡πà‡∏ß‡∏á‡∏ô‡∏µ‡∏≠‡∏≠‡∏ô
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            base: { bg: '#0a0b12', card: '#121326', line: '#1f2140' },
            neon: { blue: '#4cc1ff', violet: '#a78bfa', fuchsia: '#ff6bff', cyan: '#3fe3ff' }
          },
          boxShadow: {
            neonBlue: '0 0 22px rgba(76,193,255,.35)',
            neonViolet: '0 0 22px rgba(167,139,250,.35)',
          }
        }
      }
    }
  </script>
  <style>
    /* ‡πÇ‡∏Ñ‡πâ‡∏î UI (Canva): ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ò‡∏µ‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô-‡∏°‡πà‡∏ß‡∏á‡∏ô‡∏µ‡∏≠‡∏≠‡∏ô */
    .glow-border { box-shadow: inset 0 0 0 1px rgba(167,139,250,.45), 0 0 16px rgba(76,193,255,.18); }
    .glow-focus:focus { outline: none; box-shadow: 0 0 0 3px rgba(76,193,255,.35); }
    .tab-active { background: linear-gradient(90deg, rgba(76,193,255,.16), rgba(167,139,250,.12)); border-left: 3px solid #4cc1ff; color: #fff !important; }
    .spin { animation: spin 0.9s linear infinite; } @keyframes spin { to { transform: rotate(360deg); } }
    .table th { background: rgba(76,193,255,.10); font-weight: 600; }
    .table tr:hover { background: rgba(167,139,250,.10); }
    /* ‡∏ó‡∏≥‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥ ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≠ */
    select option { color: #111827; }
  </style>
</head>
<body class="bg-base-bg text-white min-h-screen">
  <div class="max-w-7xl mx-auto px-4 lg:px-8 py-6">
    <!-- Header -->
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-neon-blue to-neon-violet shadow-neonBlue"></div>
        <div>
          <h1 class="text-xl md:text-2xl font-semibold tracking-wide">‡πÄ‡∏î‡∏≠‡∏∞ ‡∏ã‡∏±‡∏û‡∏û‡∏≠‡∏£‡πå‡∏ï ‡∏à‡∏≥‡∏Å‡∏±‡∏î (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà)</h1>
          <p class="text-sm text-gray-300">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ & ‡∏ï‡∏±‡∏î‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö FIFO</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <button id="refreshBtn" class="px-4 py-2 rounded-md bg-base-card hover:bg-[#171832] text-white border border-base-line transition glow-border">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <span class="text-xs text-gray-300 border border-base-line rounded px-2 py-1">‡∏ò‡∏µ‡∏°: ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô-‡∏°‡πà‡∏ß‡∏á‡∏ô‡∏µ‡∏≠‡∏≠‡∏ô</span>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-6">
      <button data-tab="dashboard" class="tab-btn px-4 py-3 rounded-lg bg-base-card border border-base-line hover:border-[color:var(--tw-shadow-color)] text-gray-200 text-left">üè† Dashboard</button>
      <button data-tab="purchase" class="tab-btn px-4 py-3 rounded-lg bg-base-card border border-base-line hover:border-[color:var(--tw-shadow-color)] text-gray-200 text-left">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      <button data-tab="issue" class="tab-btn px-4 py-3 rounded-lg bg-base-card border border-base-line hover:border-[color:var(--tw-shadow-color)] text-gray-200 text-left">üì¶ ‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (FIFO)</button>
      <button data-tab="report" class="tab-btn px-4 py-3 rounded-lg bg-base-card border border-base-line hover:border-[color:var(--tw-shadow-color)] text-gray-200 text-left">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
    </nav>

    <main>
      <!-- DASHBOARD -->
      <section id="tab-dashboard" class="tab-section">
        <div class="grid md:grid-cols-3 gap-4">
          <div class="p-5 rounded-xl bg-base-card border border-base-line glow-border">
            <p class="text-gray-300 text-sm">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏ß‡∏°</p>
            <div class="flex items-end gap-2 mt-2">
              <h2 id="kpiTotalQty" class="text-3xl font-bold">-</h2>
              <span class="text-xs text-gray-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
            </div>
            <div class="text-neon-blue text-xs mt-3">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="kpiUpdatedAt">-</span></div>
          </div>
          <div class="p-5 rounded-xl bg-base-card border border-base-line glow-border">
            <p class="text-gray-300 text-sm">Deadstock</p>
            <div class="flex items-end gap-2 mt-2">
              <h2 id="kpiDead" class="text-3xl font-bold">-</h2>
              <span class="text-xs text-gray-400">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </div>
            <div class="text-neon-violet text-xs mt-3">‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ô‡∏≤‡∏ô</div>
          </div>
          <div class="p-5 rounded-xl bg-base-card border border-base-line glow-border">
            <p class="text-gray-300 text-sm">Slow moving</p>
            <div class="flex items-end gap-2 mt-2">
              <h2 id="kpiSlow" class="text-3xl font-bold">-</h2>
              <span class="text-xs text-gray-400">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </div>
            <div class="text-neon-violet text-xs mt-3">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ä‡πâ‡∏≤</div>
          </div>
        </div>

        <div class="mt-6 grid lg:grid-cols-2 gap-4">
          <div class="p-5 rounded-xl bg-base-card border border-base-line glow-border">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏Å‡∏•‡πâ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</h3>
              <span class="text-xs text-gray-400">Products</span>
            </div>
            <div id="minList" class="mt-3 space-y-2">
              <div class="text-gray-400 text-sm">‡∏Å‡∏î ‚Äú‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</div>
            </div>
          </div>
          <div class="p-5 rounded-xl bg-base-card border border-base-line glow-border">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
              <span class="text-xs text-gray-400">Purchase / Issue</span>
            </div>
            <div id="activityList" class="mt-3 space-y-2">
              <div class="text-gray-400 text-sm">‡∏Å‡∏î ‚Äú‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</div>
            </div>
          </div>
        </div>

        <div class="mt-6 flex flex-wrap gap-3">
          <button class="go-purchase px-4 py-2 bg-gradient-to-r from-neon-blue to-neon-violet hover:from-neon-violet hover:to-neon-blue text-black font-medium rounded-md shadow-neonBlue transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
          <button class="go-issue px-4 py-2 bg-gradient-to-r from-neon-violet to-neon-blue hover:from-neon-blue hover:to-neon-violet text-black font-medium rounded-md shadow-neonViolet transition">‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (FIFO)</button>
        </div>
      </section>

      <!-- PURCHASE -->
      <section id="tab-purchase" class="tab-section hidden">
        <div class="rounded-xl bg-base-card border border-base-line glow-border p-5">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
            <input id="purchaseSearch" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏£‡∏´‡∏±‡∏™/‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)" class="hidden md:block w-64 bg-black/20 border border-base-line rounded-md px-3 py-2 text-sm glow-focus"/>
          </div>

          <!-- ‡πÇ‡∏Ñ‡πâ‡∏î UI (Canva): ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠ -->
          <form id="purchaseForm" class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm text-gray-300">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
              <select id="purchaseProduct" class="w-full mt-1 bg-transparent border border-base-line rounded-md px-3 py-2 glow-focus">
                <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Äî</option>
              </select>
            </div>
            <div>
              <label class="text-sm text-gray-300">‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (Vender)</label>
              <select id="purchaseVendor" class="w-full mt-1 bg-transparent border border-base-line rounded-md px-3 py-2 glow-focus">
                <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ ‚Äî</option>
              </select>
            </div>
            <div>
              <label class="text-sm text-gray-300">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label>
              <input id="purchaseQty" type="number" min="0" step="0.01" placeholder="0" class="w-full mt-1 bg-transparent border border-base-line rounded-md px-3 py-2 glow-focus"/>
            </div>
            <div>
              <label class="text-sm text-gray-300">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
              <input id="purchasePrice" type="number" min="0" step="0.01" placeholder="0.00" class="w-full mt-1 bg-transparent border border-base-line rounded-md px-3 py-2 glow-focus"/>
            </div>
            <div class="md:col-span-2">
              <label class="text-sm text-gray-300">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
              <input id="purchaseNote" type="text" placeholder="‡πÉ‡∏™‡πà‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" class="w-full mt-1 bg-transparent border border-base-line rounded-md px-3 py-2 glow-focus"/>
            </div>
            <div class="md:col-span-2 flex items-center gap-3">
              <button type="submit" class="px-5 py-2.5 rounded-md bg-gradient-to-r from-neon-blue to-neon-violet hover:from-neon-violet hover:to-neon-blue text-black font-medium shadow-neonBlue transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ (‡∏™‡∏£‡πâ‡∏≤‡∏á Lot)</button>
              <span id="purchaseStatus" class="text-sm text-gray-300"></span>
            </div>
          </form>

          <div class="mt-6">
            <h4 class="text-sm text-gray-300 mb-2">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á</h4>
            <pre id="purchasePreview" class="text-xs bg-black/40 border border-base-line rounded-md p-3 overflow-auto"></pre>
          </div>
        </div>
      </section>

      <!-- ISSUE -->
      <section id="tab-issue" class="tab-section hidden">
        <div class="rounded-xl bg-base-card border border-base-line glow-border p-5">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold mb-4">‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (FIFO)</h3>
            <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
            <input id="issueSearch" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏£‡∏´‡∏±‡∏™/‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)" class="hidden md:block w-64 bg-black/20 border border-base-line rounded-md px-3 py-2 text-sm glow-focus"/>
          </div>

          <!-- ‡πÇ‡∏Ñ‡πâ‡∏î UI (Canva): ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
          <form id="issueForm" class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm text-gray-300">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
              <select id="issueProduct" class="w-full mt-1 bg-transparent border border-base-line rounded-md px-3 py-2 glow-focus">
                <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Äî</option>
              </select>
            </div>
            <div>
              <label class="text-sm text-gray-300">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
              <select id="issueProject" class="w-full mt-1 bg-transparent border border-base-line rounded-md px-3 py-2 glow-focus">
                <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‚Äî</option>
              </select>
            </div>
            <div>
              <label class="text-sm text-gray-300">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</label>
              <input id="issueQty" type="number" min="0" step="0.01" placeholder="0" class="w-full mt-1 bg-transparent border border-base-line rounded-md px-3 py-2 glow-focus"/>
            </div>
            <div class="flex items-end">
              <button type="button" id="simulateFIFO" class="w-full px-5 py-2.5 rounded-md bg-gradient-to-r from-neon-violet to-neon-blue hover:from-neon-blue hover:to-neon-violet text-black font-medium shadow-neonViolet transition">‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Lot ‡πÅ‡∏ö‡∏ö FIFO</button>
            </div>
            <div class="md:col-span-2">
              <label class="text-sm text-gray-300">Lot ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î (‡∏à‡∏≥‡∏•‡∏≠‡∏á)</label>
              <div id="fifoResult" class="text-sm text-gray-200 bg-black/30 border border-base-line rounded-md p-3 min-h-[56px]">‚Äî ‡∏Å‡∏î ‚Äú‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Lot ‡πÅ‡∏ö‡∏ö FIFO‚Äù ‚Äî</div>
            </div>
            <div class="md:col-span-2 flex items-center gap-3">
              <button type="submit" class="px-5 py-2.5 rounded-md bg-gradient-to-r from-neon-blue to-neon-violet hover:from-neon-violet hover:to-neon-blue text-black font-medium shadow-neonBlue transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</button>
              <span id="issueStatus" class="text-sm text-gray-300"></span>
            </div>
          </form>

          <div class="mt-6">
            <h4 class="text-sm text-gray-300 mb-2">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á</h4>
            <pre id="issuePreview" class="text-xs bg-black/40 border border-base-line rounded-md p-3 overflow-auto"></pre>
          </div>
        </div>
      </section>

      <!-- REPORT -->
      <section id="tab-report" class="tab-section hidden">
        <div class="rounded-xl bg-base-card border border-base-line glow-border p-5">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å (StockReport)</h3>
            <div class="text-xs text-gray-400">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‚Ä¢ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ‚Ä¢ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</div>
          </div>

          <div class="overflow-auto border border-base-line rounded-lg">
            <table class="w-full table">
              <thead>
                <tr class="text-left text-sm text-gray-300">
                  <th class="px-4 py-3">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                  <th class="px-4 py-3">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                  <th class="px-4 py-3 text-right">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                  <th class="px-4 py-3 text-right">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</th>
                  <th class="px-4 py-3 text-right">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ä‡∏¥‡πâ‡∏ô</th>
                  <th class="px-4 py-3 text-right">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</th>
                  <th class="px-4 py-3">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</th>
                </tr>
              </thead>
              <tbody id="reportBody" class="text-sm">
                <tr><td class="px-4 py-3 text-gray-400" colspan="7">‡∏Å‡∏î ‚Äú‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</td></tr>
              </tbody>
            </table>
          </div>

          <div class="mt-4 text-xs text-gray-400">Fast = ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ö‡πà‡∏≠‡∏¢ ‚Ä¢ Slow = ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ä‡πâ‡∏≤ ‚Ä¢ Deadstock = ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ô‡∏≤‡∏ô</div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // =========================
    // ‡πÇ‡∏Ñ‡πâ‡∏î UI (Canva): ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏è‡∏¥‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå
    // =========================
    const tabs = ['dashboard','purchase','issue','report'];
    const tabButtons = document.querySelectorAll('.tab-btn');
    const sections = Object.fromEntries(tabs.map(t=>[t, document.getElementById('tab-'+t)]));

    function setActiveTab(name){
      tabs.forEach(t=>sections[t].classList.toggle('hidden', t!==name));
      tabButtons.forEach(b=>b.dataset.tab===name ? b.classList.add('tab-active') : b.classList.remove('tab-active'));
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    tabButtons.forEach(btn=>btn.addEventListener('click', ()=>setActiveTab(btn.dataset.tab)));
    document.querySelectorAll('.go-purchase').forEach(b=>b.addEventListener('click', ()=>setActiveTab('purchase')));
    document.querySelectorAll('.go-issue').forEach(b=>b.addEventListener('click', ()=>setActiveTab('issue')));
    setActiveTab('dashboard');

    // =========================
    // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script
    // =========================
    // READ_API: doGet URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á)
    const READ_API = 'https://script.google.com/macros/s/AKfycbzaQ9Xet70T5VRuT9ljWC-LLGyl9-7Lan_QjBBQ6VVK3lcFdz25luiE8OVnOLzUfu1M/exec';
    // WRITE_API: doPost URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô /exec)
    const WRITE_API = 'https://script.google.com/macros/s/AKfycbyDwhbkcMgQr3T5BSeIKsCnKrAlYJ4fa5AR86TfzBeIegcgGMiY2eaq6uGU89jMCos/exec';

    // ‡πÅ‡∏Ñ‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    let cache = { products: [], vendors: [], projects: [], stockReport: [], lots: [], recentActivities: [], lastUpdated: null };

    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    function fillOptions(selectEl, items, getValue, getLabel){
      selectEl.innerHTML = '<option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option>';
      items.forEach(it=>{
        const opt = document.createElement('option');
        opt.value = getValue(it);
        opt.textContent = getLabel(it);
        selectEl.appendChild(opt);
      });
    }
    // ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô select ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)
    function filterProductSelect(selectEl, query){
      const q = (query||'').toLowerCase().trim();
      const all = cache.products.map(it=>({ value: it['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'], label: `${it['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']} ‚Äî ${it['‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']}` }));
      const filtered = q ? all.filter(o=> o.label.toLowerCase().includes(q)) : all;
      selectEl.innerHTML = '<option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî</option>';
      filtered.forEach(o=>{
        const opt = document.createElement('option');
        opt.value = o.value; opt.textContent = o.label;
        selectEl.appendChild(opt);
      });
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
    async function loadAll(){
      setLoading(true);
      setPlaceholders();
      try{
        const res = await fetch(READ_API, { method: 'GET' });
        if(!res.ok) throw new Error('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        const data = await res.json();
        cache.products = Array.isArray(data.products)?data.products:[];
        cache.vendors = Array.isArray(data.vendors)?data.vendors:[];
        cache.projects = Array.isArray(data.projects)?data.projects:[];
        cache.stockReport = Array.isArray(data.stockReport)?data.stockReport:[];
        cache.lots = Array.isArray(data.lots)?data.lots:[];
        cache.recentActivities = Array.isArray(data.recentActivities)?data.recentActivities:[];
        cache.lastUpdated = new Date();

        renderDropdowns();
        renderDashboard();
        renderReport();
      }catch(e){
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å READ_API ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL doGet ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á');
      }finally{
        setLoading(false);
      }
    }

    function setLoading(isLoading){
      const btn = document.getElementById('refreshBtn');
      if(isLoading){
        btn.innerHTML = '<span class="inline-flex items-center gap-2"><span class="w-4 h-4 border-2 border-white/60 border-t-transparent rounded-full spin"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î</span>';
        btn.disabled = true; btn.classList.add('opacity-70');
      }else{
        btn.textContent = '‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        btn.disabled = false; btn.classList.remove('opacity-70');
      }
    }
    function setPlaceholders(){
      document.getElementById('minList').innerHTML = `<div class="text-gray-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>`;
      document.getElementById('activityList').innerHTML = `<div class="text-gray-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>`;
      document.getElementById('reportBody').innerHTML = `<tr><td class="px-4 py-3 text-gray-400" colspan="7">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>`;
    }
    function showError(msg){
      document.getElementById('minList').innerHTML = `<div class="text-red-300 text-sm">${msg}</div>`;
      document.getElementById('activityList').innerHTML = `<div class="text-red-300 text-sm">${msg}</div>`;
      document.getElementById('reportBody').innerHTML = `<tr><td class="px-4 py-3 text-red-300" colspan="7">${msg}</td></tr>`;
    }

    function renderDropdowns(){
      // PURCHASE
      fillOptions(
        document.getElementById('purchaseProduct'),
        cache.products,
        it=>it['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'],
        it=>`${it['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']} ‚Äî ${it['‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']}`
      );
      fillOptions(
        document.getElementById('purchaseVendor'),
        cache.vendors,
        it=>it['‡∏£‡∏´‡∏±‡∏™ Vendors'] || it['‡∏£‡∏´‡∏±‡∏™Vendors'],
        it=>`${(it['‡∏£‡∏´‡∏±‡∏™ Vendors']||it['‡∏£‡∏´‡∏±‡∏™Vendors'])} ‚Äî ${it['Vender']}`
      );
      // ISSUE
      fillOptions(
        document.getElementById('issueProduct'),
        cache.products,
        it=>it['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'],
        it=>`${it['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']} ‚Äî ${it['‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']}`
      );
      fillOptions(
        document.getElementById('issueProject'),
        cache.projects,
        it=>it['‡∏£‡∏´‡∏±‡∏™'],
        it=>`${it['‡∏£‡∏´‡∏±‡∏™']} ‚Äî ${it['‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£']}${it['‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠']?' ('+it['‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠']+')':''}`
      );
      // Hook ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏î
      const pSearch = document.getElementById('purchaseSearch');
      const iSearch = document.getElementById('issueSearch');
      if(pSearch){ pSearch.addEventListener('input', (e)=> filterProductSelect(document.getElementById('purchaseProduct'), e.target.value)); }
      if(iSearch){ iSearch.addEventListener('input', (e)=> filterProductSelect(document.getElementById('issueProduct'), e.target.value)); }
    }

    function renderDashboard(){
      const totalQty = cache.stockReport.reduce((s,r)=>s+(+r['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']||0),0);
      const dead = cache.stockReport.filter(r=> (r['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']||'').toLowerCase()==='deadstock').length;
      const slow = cache.stockReport.filter(r=> (r['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']||'').toLowerCase()==='slow').length;
      document.getElementById('kpiTotalQty').textContent = Number(totalQty).toLocaleString('th-TH');
      document.getElementById('kpiDead').textContent = dead;
      document.getElementById('kpiSlow').textContent = slow;
      document.getElementById('kpiUpdatedAt').textContent = cache.lastUpdated ? cache.lastUpdated.toLocaleString('th-TH') : '-';

      // ‡πÉ‡∏Å‡∏•‡πâ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥
      const minList = document.getElementById('minList');
      const lowItems = cache.stockReport.filter(r => (+r['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']||0) <= (+r['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥']||0));
      if(lowItems.length===0){
        minList.innerHTML = '<div class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</div>';
      }else{
        minList.innerHTML = '';
        lowItems.slice(0,8).forEach(r=>{
          const row = document.createElement('div');
          row.className = 'flex items-center justify-between bg-black/25 border border-base-line rounded-md px-3 py-2';
          row.innerHTML = `
            <div>
              <div class="font-medium">${r['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']} ‚Äî ${r['‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']}</div>
              <div class="text-xs text-gray-300">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${r['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']} | ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${r['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥']}</div>
            </div>
            <button class="go-purchase text-xs px-3 py-1 rounded bg-gradient-to-r from-neon-blue to-neon-violet text-black font-medium">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
          `;
          row.querySelector('.go-purchase').addEventListener('click', ()=>setActiveTab('purchase'));
          minList.appendChild(row);
        });
      }

      // ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
      const actList = document.getElementById('activityList');
      actList.innerHTML = '';
      if(cache.recentActivities.length===0){
        actList.innerHTML = '<div class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>';
      }else{
        cache.recentActivities.slice(0,8).forEach(a=>{
          const color = a.type==='purchase' ? 'text-neon-blue' : 'text-neon-violet';
          const el = document.createElement('div');
          el.className = 'flex items-center justify-between bg-black/25 border border-base-line rounded-md px-3 py-2';
          el.innerHTML = `<div class="text-sm ${color}">${a.text}</div><div class="text-xs text-gray-400">${a.at||''}</div>`;
          actList.appendChild(el);
        });
      }
    }

    function renderReport(){
      const body = document.getElementById('reportBody');
      body.innerHTML = '';
      if(cache.stockReport.length===0){
        body.innerHTML = '<tr><td class="px-4 py-3 text-gray-400" colspan="7">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
        return;
      }
      cache.stockReport.forEach(r=>{
        const tr = document.createElement('tr');
        tr.className = 'border-t border-base-line/60';
        const type = (r['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']||'').toLowerCase();
        const badge = type==='fast' ? 'bg-emerald-500/20 text-emerald-300' :
                      type==='slow' ? 'bg-yellow-500/20 text-yellow-300' :
                      'bg-red-500/20 text-red-300';
        tr.innerHTML = `
          <td class="px-4 py-3">${r['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']||''}</td>
          <td class="px-4 py-3">${r['‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']||''}</td>
          <td class="px-4 py-3 text-right">${Number(r['‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']||0).toLocaleString('th-TH')}</td>
          <td class="px-4 py-3 text-right">${Number(r['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥']||0).toLocaleString('th-TH')}</td>
          <td class="px-4 py-3 text-right">${Number(r['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô']||0).toLocaleString('th-TH',{minimumFractionDigits:2})}</td>
          <td class="px-4 py-3 text-right">${Number(r['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô']||0).toLocaleString('th-TH',{minimumFractionDigits:2})}</td>
          <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded ${badge}">${r['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']||'-'}</span></td>
        `;
        body.appendChild(tr);
      });
    }

    // =========================
    // ‡πÇ‡∏Ñ‡πâ‡∏î UI (Canva): ‡∏ü‡∏≠‡∏£‡πå‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"
    // =========================
    const purchaseForm = document.getElementById('purchaseForm');
    const purchaseStatus = document.getElementById('purchaseStatus');
    const purchasePreview = document.getElementById('purchasePreview');

    function getPurchasePayload(withAction=true){
      const pid = (document.getElementById('purchaseProduct').value||'').trim();
      const ven = (document.getElementById('purchaseVendor').value||'').trim();
      const qty = parseFloat(document.getElementById('purchaseQty').value||'0');
      const price = parseFloat(document.getElementById('purchasePrice').value||'0');
      const note = (document.getElementById('purchaseNote').value||'').trim();
      const payload = {
        actionType: withAction ? 'purchase' : undefined,
        sheet: 'PurchaseTransactions',
        data: {
          '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': new Date().toISOString().slice(0,10),
          '‡∏£‡∏´‡∏±‡∏™ Vender': ven,
          '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤': pid,
          '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠': qty,
          '‡∏£‡∏≤‡∏Ñ‡∏≤': price,
          '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°': qty*price,
          '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏': note
        }
      };
      if(!withAction) delete payload.actionType;
      return payload;
    }

    purchaseForm.addEventListener('input', ()=>{
      purchasePreview.textContent = JSON.stringify(getPurchasePayload(false), null, 2);
    });

    purchaseForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      purchaseStatus.textContent = '';
      const pid = document.getElementById('purchaseProduct').value;
      const ven = document.getElementById('purchaseVendor').value;
      const qty = parseFloat(document.getElementById('purchaseQty').value||'0');
      const price = parseFloat(document.getElementById('purchasePrice').value||'0');

      if(!pid || !ven || qty<=0 || price<0){
        purchaseStatus.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô';
        return;
      }

      const payload = getPurchasePayload(true);
      purchasePreview.textContent = JSON.stringify(payload, null, 2);

      try{
        await sendToAppsScript(payload, purchaseStatus);
        loadAll();
        purchaseForm.reset();
      }catch(err){
        // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏î‡∏¢ sendToAppsScript ‡πÅ‡∏•‡πâ‡∏ß
      }
    });

    // =========================
    // ‡πÇ‡∏Ñ‡πâ‡∏î UI (Canva): ‡∏ü‡∏≠‡∏£‡πå‡∏° "‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (FIFO)"
    // =========================
    const issueForm = document.getElementById('issueForm');
    const issueStatus = document.getElementById('issueStatus');
    const issuePreview = document.getElementById('issuePreview');
    const fifoResult = document.getElementById('fifoResult');

    function getIssuePayload(withAction=true, picks=[]){
      const pid = (document.getElementById('issueProduct').value||'').trim();
      const proj = (document.getElementById('issueProject').value||'').trim();
      const qty = parseFloat(document.getElementById('issueQty').value||'0');
      const payload = {
        actionType: withAction ? 'issue' : undefined,
        sheet: 'IssueTransactions',
        data: {
          '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': new Date().toISOString().slice(0,10),
          '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤': pid,
          '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å': qty,
          '‡∏£‡∏´‡∏±‡∏™‡∏à‡∏∏‡∏î‡πÄ‡∏ö‡∏¥‡∏Å': proj,
          'lotDraft': picks
        }
      };
      if(!withAction) delete payload.actionType;
      return payload;
    }

    document.getElementById('simulateFIFO').addEventListener('click', ()=>{
      const pid = (document.getElementById('issueProduct').value||'').trim();
      const qtyReq = parseFloat(document.getElementById('issueQty').value||'0');
      if(!pid || qtyReq<=0){
        fifoResult.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        issuePreview.textContent = JSON.stringify(getIssuePayload(false, []), null, 2);
        return;
      }
      const lots = cache.lots
        .filter(l => l['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']===pid && (+l['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']||0) > 0)
        .sort((a,b)=> new Date(a['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà']) - new Date(b['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'])); // ‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô

      let remain = qtyReq, pick = [];
      for(const lot of lots){
        if(remain<=0) break;
        const take = Math.min(remain, +lot['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']||0);
        if(take>0){
          pick.push({ lotId: lot.lotId || lot['Lotstoct'] || 'LOT', qty: take, price: +lot['‡∏£‡∏≤‡∏Ñ‡∏≤']||0, date: lot['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'] });
          remain -= take;
        }
      }

      const stockBefore = lots.reduce((s,l)=> s + (+l['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']||0), 0);
      const stockAfter = stockBefore - qtyReq;

      if(remain>0){
        fifoResult.innerHTML = `<span class="text-red-300">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å ${remain}</span><div class="mt-2 text-sm">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏ß‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <b>${stockBefore}</b></div>`;
      }else{
        const lotLines = pick.map(p=>`‚Ä¢ Lot ${p.lotId} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${p.date} ‚Äî ‡∏ï‡∏±‡∏î ${p.qty} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏£‡∏≤‡∏Ñ‡∏≤ ${p.price})`).join('<br>');
        fifoResult.innerHTML = `${lotLines}<br><div class="mt-2 text-neon-blue">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏î: <b>${stockAfter}</b></div>`;
      }
      issuePreview.textContent = JSON.stringify(getIssuePayload(false, pick), null, 2);
    });

    issueForm.addEventListener('input', ()=>{
      const pid = (document.getElementById('issueProduct').value||'').trim();
      const qty = parseFloat(document.getElementById('issueQty').value||'0');
      const lots = cache.lots
        .filter(l => l['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']===pid && (+l['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']||0) > 0)
        .sort((a,b)=> new Date(a['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà']) - new Date(b['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà']));
      const stockBefore = lots.reduce((s,l)=> s + (+l['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠']||0), 0);
      const stockAfter = isNaN(qty) ? stockBefore : (stockBefore - qty);
      if(pid && qty>0){
        fifoResult.innerHTML = `<div class="text-xs text-gray-300">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <b>${stockBefore}</b> ‚Ä¢ ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏î: <b class="text-neon-blue">${Math.max(stockAfter,0)}</b></div>`;
      }
      issuePreview.textContent = JSON.stringify(getIssuePayload(false, []), null, 2);
    });

    issueForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      issueStatus.textContent = '';
      const pid = document.getElementById('issueProduct').value;
      const proj = document.getElementById('issueProject').value;
      const qty = parseFloat(document.getElementById('issueQty').value||'0');

      if(!pid || !proj || qty<=0){
        issueStatus.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô';
        return;
      }
      const payload = getIssuePayload(true, []);
      issuePreview.textContent = JSON.stringify(payload, null, 2);

      try{
        await sendToAppsScript(payload, issueStatus);
        loadAll();
        issueForm.reset();
        fifoResult.textContent = '‚Äî ‡∏Å‡∏î ‚Äú‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Lot ‡πÅ‡∏ö‡∏ö FIFO‚Äù ‚Äî';
      }catch(err){
        // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏î‡∏¢ sendToAppsScript ‡πÅ‡∏•‡πâ‡∏ß
      }
    });

    // =========================
    // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Apps Script: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Ç‡∏∂‡πâ‡∏ô
    // - ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö JSON ‡∏Å‡πà‡∏≠‡∏ô ‡∏ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡∏à‡∏∞‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏£‡∏≠‡∏á (form-encoded)
    // - ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå/‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    // =========================
    async function sendToAppsScript(payload, statusEl){
      statusEl.innerHTML = '<span class="inline-flex items-center gap-2 text-gray-200"><span class="w-4 h-4 border-2 border-white/60 border-t-transparent rounded-full spin"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>';
      // ‡∏•‡∏≠‡∏á‡πÅ‡∏ö‡∏ö JSON ‡∏Å‡πà‡∏≠‡∏ô
      try{
        const r1 = await fetch(WRITE_API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const t = await r1.text(); // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô JSON
        let result;
        try { result = JSON.parse(t); } catch { result = { ok: r1.ok, message: t || (r1.ok?'OK':'Error') }; }
        if(!r1.ok || result.ok===false){
          throw new Error(result.message || '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
        statusEl.innerHTML = `<span class="text-neon-blue">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:</span> ${result.message || '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'}`;
        return true;
      }catch(errJSON){
        // ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≥‡∏£‡∏≠‡∏á: ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô form-encoded (‡∏ö‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ)
        try{
          const r2 = await fetch(WRITE_API, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
            body: 'payload=' + encodeURIComponent(JSON.stringify(payload))
          });
          const t2 = await r2.text();
          let result2;
          try { result2 = JSON.parse(t2); } catch { result2 = { ok: r2.ok, message: t2 || (r2.ok?'OK':'Error') }; }
          if(!r2.ok || result2.ok===false){
            throw new Error(result2.message || '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          }
          statusEl.innerHTML = `<span class="text-neon-blue">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:</span> ${result2.message || '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'}`;
          return true;
        }catch(errForm){
          statusEl.innerHTML = `<span class="text-red-300">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ:</span> ${errForm.message || '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö WRITE_API / doPost'}`
          throw errForm;
        }
      }
    }

    // ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
    document.getElementById('refreshBtn').addEventListener('click', loadAll);

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    loadAll();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9716f458b40745ba',t:'MTc1NTU3ODIzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
